-- 1.-- Crear tabla def de Sector_Productivo
-- --<sql>--DROP TABLE IF EXISTS `caba-piba-staging-zone-db`.`tbp_typ_def_sector_productivo`;--</sql>--
--<sql>--
CREATE TABLE "caba-piba-staging-zone-db"."tbp_typ_def_sector_productivo" AS
--CLAE
WITH clae AS (
SELECT
cod_actividad_afip_o_naes AS codigo_clae,
--se crea el campo sector productivo
CASE
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (530010,492230,492290,492221,492229,492250,492190,492170,492280,491200,502200,501200,492240,493200,493110,493120,524290,524190,523020,522099,524210,524110,522092,523090,521030,521020,521010,530090,523039,801010,524230,351201,492210,492160,492150,492180,492140,492110,492130,491120,491110,502101,501100,524130,492120,309100,301100,301200,522091,524120,309900,302000,524220) THEN 'ABASTECIMIENTO Y LOGISTICA'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (649100,661131,823000,643009,661999,661910,821100,661992,829100,649910,702099,702092,702091,949990,661920,692000,649290,649220,661991,662010,643001,649999,821900,663000,641943,641941,641942,641920,641910,641930,661121,661111,949910,941100,941200,931010,942000,661930,642000,649991,829900,649210,949930,829200) THEN 'ADMINISTRACION, CONTABILIDAD Y FINANZAS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (523019,523031,523032,523011) THEN 'ADUANA Y COMERCIO EXTERIOR'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (524390,524310,303000,511000,524320,524330,512000) THEN 'AERONAUTICA'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (462110,462132,461014,13,16292,14910,17010,14930,14990,14810,14300,14121,14113,14430,14440,14221,14211,14410,14420,14520,14510,11501,11111,11329,12510,11129,11119,12800,11911,12200,12320,12319,12490,12420,12410,12600,11291,11331,11341,11342,12311,11121,11299,11310,11130,11912,11509,12590,11211,11400,11321,11112,12709,12121,12110,12701,12900,11990,14920,14115,32000,21030,22010,22020,81100,89300,51000,52000,89200,16210,14114,461031,461032,31200,31110,31120,21010,14820,14710,14610,14620,13020,14720,13019,13013,13011,13012,31130,21020,522020,522010,16190,17020,31300,16299,16130,16220,16120,16230,16119,939010,16140,16150,24020,24010) THEN 'AGRICULTURA, GANADERIA, CAZA Y SERVICIOS CONEXOS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (822000) THEN 'ATENCION AL CLIENTE, CALL CENTER Y TELEMARKETING'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (281100,221901,221110,452700,452101,452800,454020,452990,221120,293011,452401,452220,452210,452600,452500,452300,452910,292000,293090,291000) THEN 'AUTOMOTRIZ'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (465500,464910,466310,466932,463153,463170,464632,464950,466330,464620,464223,466391,464149,464112,466931,464420,464999,464631,464410,466399,466360,463129,463152,463219,463212,463220,464940,463154,464130,463121,462131,463160,463300,466110,466129,465220,466350,464212,464501,464222,465930,464502,465210,465100,463112,464991,463191,464330,469010,464930,462201,464211,464113,465920,464920,462190,462209,464122,469090,466200,465690,465610,464610,465400,465910,465990,465340,465320,465360,465310,465390,465350,463151,464221,466370,453100,463130,464141,466340,464121,464129,463199,464320,466320,464310,466920,466940,466910,466939,466990,463111,464119,464340,463159,462120,464142,464114,464111,464150,463211,461092,461094,461099,461039,461011,461040,461013,461021,461022,461093,461095,461091,461019,461029,461012,463180,463140,475300,476200,475210,478010,477830,474020,476320,475440,475230,475430,477290,477420,477210,477410,477490,475490,475250,475190,477890,453220,472200,477430,472172,477230,477220,472130,475420,473000,475120,475260,453210,476120,476310,474010,472112,477440,472160,477460,475110,472140,477140,477130,477330,476400,476110,477820,475220,475290,477450,475410,477810,477480,477840,472171,476130,475270,453291,453292,472150,475240,477150,477190,472190,477320,472120,477310,472111,478090,477470,477110,472300,477120,471900,471110,471190,471130,471120,479900,479109,479101,451110,451210,454010,451190,451290,465330,771210,771290,774000,771220,773010,771110,771190,773030,773020,772091,773040,772099,773090,772010,771110) THEN 'COMERCIAL, VENTAS Y NEGOCIOS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (741000) THEN 'DISEÑO'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (749009,853100,854960,854920,854950,854910,854940,851020,854930,852100,852200,853201,8,853300,721030,722020,722010,721090,855000,854990,851010) THEN 'EDUCACION, DOCENCIA E INVESTIGACION'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (920009,900021,591200,591300,931020,591120,900011,591110,931030,182000,900030,910900,910100,939090,900091,592000,910200,920001,939030,939020,931090,931041,931042,900040) THEN 'ENTRETENIMIENTO, ESPECTACULOS Y ACTIVIDADES CULTURALES'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (791909,561013,552000,551022,551023,551021,551010,562099,561014,561019,551090,791901,791200,791100,561012,561011,561030,562091,562010,561020,561040) THEN 'GASTRONOMIA, HOTELERIA Y TURISMO'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (432110,431210,439990,432920,439100,433030,429090,410021,410011,421000,429010,422200,431100,432910,432990,332000,711009,711001,433090,433010,422100,431220,432200,433020,439910) THEN 'INGENIERIA CIVIL, ARQUITECTURA Y CONSTRUCCION'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (432190) THEN 'INGENIERIAS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (691002,691001) THEN 'LEGALES/ABOGACIA'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (331290,331210,331900,16113,16112,813000,812020,331101,331400,331301,331220,949920,812010,811000,812090) THEN 'LIMPIEZA Y MANTENIMIENTO'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (732000,731001,731009) THEN 'MARKETING Y PUBLICIDAD'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (351310,351320,89900,81300,62000,72910,71000,72990,89110,89120,72100,61000,192000,466121,351130,351190,351110,351120,91000,99000,711002,353001,81400,360010,360020,352020,352010) THEN 'MINERIA, ENERGIA, PETROLEO, AGUA Y GAS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (801090,9,181109,7,433040,952910,952990,952920,952300,742000,749002,749003,749001,16291,12,11,181200) THEN 'OFICIOS Y OTROS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (639100,581300,581900,602100,601000,181101,639900,602320,581100,602310,602200,602900,581200) THEN 'PRENSA Y MEDIOS DE COMUNICACIÓN'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (110100,239421,108000,242010,110420,110492,107301,239422,239410,110300,120091,107991,101030,107110,110491,239591,104020,107410,107420,102002,107999,107309,107129,120099,105090,105020,110290,107930,105030,107121,103012,107912,110411,81200,221909,281900,201300,201210,252000,239593,239399,259302,323001,162902,170910,170990,239310,162901,309200,321020,201220,281201,259992,251101,329030,170202,259309,281400,202907,201140,281301,202320,201120,231010,259910,222010,329040,329020,202906,203000,201110,162100,281500,322001,202312,321011,324000,239201,329010,282300,282500,282901,281600,281700,282909,201130,201409,201180,201190,210010,210020,239510,310020,310010,282200,239391,321012,170201,170102,170101,202200,202311,239209,239100,162903,210090,162909,231090,259999,259993,251102,239900,222090,242090,202908,162300,201401,239202,110412,310030,251200,259991,282110,162202,241009,231020,259100,243100,243200,329090,241001,109000,204000,952200,104013,104011,101040,104012,102001,103091,103099,103030,103011,105010,101020,101099,101012,101011,101040,101091,106131,106120,106110,106139,106200,107200,107930,107911,107920,107992,110211,110212,202101,282120,282130,161001,161002,103020,162201,282400,239592,259200,251300,239600,210030,107500,191000,259301,282600,120010,102003,101013) THEN 'PRODUCCION Y MANUFACTURA (SIN TEXTIL, ELECTRONICA Y AUTOMOTRIZ)'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (780000) THEN 'RECURSOS HUMANOS Y CAPACITACION'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (721020,712000,863300,862110,931050,870100,862130,864000,702010,861020,861010,862120,863110,863190,863120,869010,862200,869090,870990,750000,870210,870910,870220,863200,870920,880000,970000) THEN 'SALUD, MEDICINA, FARMACIA Y ASISTENCIA SOCIAL'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (641100,842400,10,841900,842100,842200,910300,843000,16111,842500,841100,842300,841300,841200) THEN 'SECTOR PUBLICO'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (653000,652000,662090,651210,662020,651120,651220,651130,651320,651110,651310) THEN 'SEGUROS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (390000,381100,381200,382010,382020,370000) THEN 'SERVICIOS DE MANEJO DE RESIDUOS Y DE REMEDIACION'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (949200,949100,990000) THEN 'SERVICIOS DE ORGANIZACIONES POLITICAS Y RELIGIOSAS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (681020,681010,682099,681099,681098,682091,682010) THEN 'SERVICIOS INMOBILIARIOS Y ALQUILER DE BIENES MUEBLES E INTANGIBLES'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (960910,960201,960202,960990,960101,960300,960102) THEN 'SERVICIOS PERSONALES (SECTOR A INCORPORAR EN TAXONOMIA DE TYP) POSICION 96 DE LA LETRA S (FUENTE: CLAE AFIP)'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (279000,262000,264000,263000,721010,631200,952100,951200,951100,620200,620100,620300,620900,611010,614010,801020,619000,613000,614090,611090,612000,711003,631190,631120,631110,271020,271010,266010,266090,265101,265200,267002,265102,268000,261000,267001,266010,266090,272000,274000,275091,275020,273110,275099,275092,273190,275010 ) THEN 'TECNOLOGIA, SISTEMAS Y TELECOMUNICACIONES'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (131300,141130,141140,141120,141110,141191,139209,139204,131132,131131,131139,143010,143020,139900,131202,131209,131201,149000,142000,131120,131110,139400,139202,139203,139201,139100,139300,151100,141191,141199,141201,141202,152040,152011,152031,152021,151200) THEN 'TEXTIL'
END sector_productivo
FROM "caba-piba-raw-zone-db"."tbp_typ_tmp_nomenclador_actividades_economicas"
WHERE (cod_actividad_afip_o_naes IS NOT NULL OR LENGTH(TRIM(TRY_CAST(cod_actividad_afip_o_naes AS VARCHAR))) <> 0)
GROUP BY 1,2
),
--portal_empleo_mtr_industry_sectors
inds AS (
SELECT
isec.code AS codigo_mtr,
CASE
    WHEN TRY_CAST(isec.code AS INT) IN (1143) THEN 'ABASTECIMIENTO Y LOGISTICA'
    WHEN TRY_CAST(isec.code AS INT) IN (558,1773,701) THEN 'ADMINISTRACION, CONTABILIDAD Y FINANZAS'
    WHEN TRY_CAST(isec.code AS INT) IN (2723) THEN 'ADUANA Y COMERCIO EXTERIOR'
    WHEN TRY_CAST(isec.code AS INT) IN (1174) THEN 'ATENCION AL CLIENTE, CALL CENTER Y TELEMARKETING'
    WHEN TRY_CAST(isec.code AS INT) IN (2888) THEN 'COMERCIAL, VENTAS Y NEGOCIOS'
    WHEN TRY_CAST(isec.code AS INT) IN (16) THEN 'DISEÑO'
    WHEN TRY_CAST(isec.code AS INT) IN (18) THEN 'EDUCACION, DOCENCIA E INVESTIGACION'
    WHEN TRY_CAST(isec.code AS INT) IN (25) THEN  'GASTRONOMIA, HOTELERIA Y TURISMO'
    WHEN TRY_CAST(isec.code AS INT) IN (4) THEN 'INGENIERIA CIVIL, ARQUITECTURA Y CONSTRUCCION'
    WHEN TRY_CAST(isec.code AS INT) IN (648) THEN 'INGENIERIAS'
    WHEN TRY_CAST(isec.code AS INT) IN (601) THEN 'LEGALES/ABOGACIA'
    WHEN TRY_CAST(isec.code AS INT) IN (45) THEN 'MARKETING Y PUBLICIDAD'
    WHEN TRY_CAST(isec.code AS INT) IN (19) THEN 'MINERIA, ENERGIA, PETROLEO, AGUA Y GAS'
    WHEN TRY_CAST(isec.code AS INT) IN (1108) THEN 'OFICIOS Y OTROS'
    WHEN TRY_CAST(isec.code AS INT) IN (734) THEN 'PRODUCCION Y MANUFACTURA (SIN TEXTIL, ELECTRONICA Y AUTOMOTRIZ)'
    WHEN TRY_CAST(isec.code AS INT) IN (590) THEN 'RECURSOS HUMANOS Y CAPACITACION'
    WHEN TRY_CAST(isec.code AS INT) IN (48) THEN 'SALUD, MEDICINA, FARMACIA Y ASISTENCIA SOCIAL'
    WHEN TRY_CAST(isec.code AS INT) IN (2889,2890,2891) THEN 'SECTOR PUBLICO'
    WHEN TRY_CAST(isec.code AS INT) IN (49) THEN 'SEGUROS'
    WHEN TRY_CAST(isec.code AS INT) IN (32) THEN 'TECNOLOGIA, SISTEMAS Y TELECOMUNICACIONES'
END sector_productivo
FROM "caba-piba-raw-zone-db"."portal_empleo_mtr_industry_sectors" isec
),
sp AS (
SELECT
sector_productivo
FROM clae
WHERE sector_productivo IS NOT NULL
GROUP BY sector_productivo
ORDER BY sector_productivo
)
SELECT
row_number() OVER () AS id_sector_productivo,
sector_productivo
FROM sp
--</sql>--