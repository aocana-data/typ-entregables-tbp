-- 1.-- Crear tabla def de match entre sector estrategico y sector productivo
-- --<sql>--DROP TABLE IF EXISTS `caba-piba-staging-zone-db`.`tbp_typ_def_match_sector_estrategico_sector_productivo`;--</sql>--
--<sql>--
CREATE TABLE "caba-piba-staging-zone-db"."tbp_typ_def_match_sector_estrategico_sector_productivo" AS
--match sector estrategico - sector productivo - CLAE
WITH clae AS (
SELECT
cod_actividad_afip_o_naes AS codigo_clae,
cod_actividad_afip_o_naes_string AS codigo_clae_string,
SUBSTRING(cod_actividad_afip_o_naes_string,1,2) AS codigo_corto_clae,
--se crea el campo sector productivo
CASE
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (530010,492230,492290,492221,492229,492250,492190,492170,492280,491200,502200,501200,492240,493200,493110,493120,524290,524190,523020,522099,524210,524110,522092,523090,521030,521020,521010,530090,523039,801010,524230,351201,492210,492160,492150,492180,492140,492110,492130,491120,491110,502101,501100,524130,492120,309100,301100,301200,522091,524120,309900,302000,524220) THEN 'ABASTECIMIENTO Y LOGISTICA'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (649100,661131,823000,643009,661999,661910,821100,661992,829100,649910,702099,702092,702091,949990,661920,692000,649290,649220,661991,662010,643001,649999,821900,663000,641943,641941,641942,641920,641910,641930,661121,661111,949910,941100,941200,931010,942000,661930,642000,649991,829900,649210,949930,829200) THEN 'ADMINISTRACION, CONTABILIDAD Y FINANZAS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (523019,523031,523032,523011) THEN 'ADUANA Y COMERCIO EXTERIOR'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (524390,524310,303000,511000,524320,524330,512000) THEN 'AERONAUTICA'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (462110,462132,461014,13,16292,14910,17010,14930,14990,14810,14300,14121,14113,14430,14440,14221,14211,14410,14420,14520,14510,11501,11111,11329,12510,11129,11119,12800,11911,12200,12320,12319,12490,12420,12410,12600,11291,11331,11341,11342,12311,11121,11299,11310,11130,11912,11509,12590,11211,11400,11321,11112,12709,12121,12110,12701,12900,11990,14920,14115,32000,21030,22010,22020,81100,89300,51000,52000,89200,16210,14114,461031,461032,31200,31110,31120,21010,14820,14710,14610,14620,13020,14720,13019,13013,13011,13012,31130,21020,522020,522010,16190,17020,31300,16299,16130,16220,16120,16230,16119,939010,16140,16150,24020,24010) THEN 'AGRICULTURA, GANADERIA, CAZA Y SERVICIOS CONEXOS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (822000) THEN 'ATENCION AL CLIENTE, CALL CENTER Y TELEMARKETING'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (281100,221901,221110,452700,452101,452800,454020,452990,221120,293011,452401,452220,452210,452600,452500,452300,452910,292000,293090,291000) THEN 'AUTOMOTRIZ'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (465500,464910,466310,466932,463153,463170,464632,464950,466330,464620,464223,466391,464149,464112,466931,464420,464999,464631,464410,466399,466360,463129,463152,463219,463212,463220,464940,463154,464130,463121,462131,463160,463300,466110,466129,465220,466350,464212,464501,464222,465930,464502,465210,465100,463112,464991,463191,464330,469010,464930,462201,464211,464113,465920,464920,462190,462209,464122,469090,466200,465690,465610,464610,465400,465910,465990,465340,465320,465360,465310,465390,465350,463151,464221,466370,453100,463130,464141,466340,464121,464129,463199,464320,466320,464310,466920,466940,466910,466939,466990,463111,464119,464340,463159,462120,464142,464114,464111,464150,463211,461092,461094,461099,461039,461011,461040,461013,461021,461022,461093,461095,461091,461019,461029,461012,463180,463140,475300,476200,475210,478010,477830,474020,476320,475440,475230,475430,477290,477420,477210,477410,477490,475490,475250,475190,477890,453220,472200,477430,472172,477230,477220,472130,475420,473000,475120,475260,453210,476120,476310,474010,472112,477440,472160,477460,475110,472140,477140,477130,477330,476400,476110,477820,475220,475290,477450,475410,477810,477480,477840,472171,476130,475270,453291,453292,472150,475240,477150,477190,472190,477320,472120,477310,472111,478090,477470,477110,472300,477120,471900,471110,471190,471130,471120,479900,479109,479101,451110,451210,454010,451190,451290,465330,771210,771290,774000,771220,773010,771110,771190,773030,773020,772091,773040,772099,773090,772010,771110) THEN 'COMERCIAL, VENTAS Y NEGOCIOS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (741000) THEN 'DISEÑO'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (749009,853100,854960,854920,854950,854910,854940,851020,854930,852100,852200,853201,8,853300,721030,722020,722010,721090,855000,854990,851010) THEN 'EDUCACION, DOCENCIA E INVESTIGACION'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (920009,900021,591200,591300,931020,591120,900011,591110,931030,182000,900030,910900,910100,939090,900091,592000,910200,920001,939030,939020,931090,931041,931042,900040) THEN 'ENTRETENIMIENTO, ESPECTACULOS Y ACTIVIDADES CULTURALES'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (791909,561013,552000,551022,551023,551021,551010,562099,561014,561019,551090,791901,791200,791100,561012,561011,561030,562091,562010,561020,561040) THEN 'GASTRONOMIA, HOTELERIA Y TURISMO'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (432110,431210,439990,432920,439100,433030,429090,410021,410011,421000,429010,422200,431100,432910,432990,332000,711009,711001,433090,433010,422100,431220,432200,433020,439910) THEN 'INGENIERIA CIVIL, ARQUITECTURA Y CONSTRUCCION'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (432190) THEN 'INGENIERIAS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (691002,691001) THEN 'LEGALES/ABOGACIA'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (331290,331210,331900,16113,16112,813000,812020,331101,331400,331301,331220,949920,812010,811000,812090) THEN 'LIMPIEZA Y MANTENIMIENTO'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (732000,731001,731009) THEN 'MARKETING Y PUBLICIDAD'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (351310,351320,89900,81300,62000,72910,71000,72990,89110,89120,72100,61000,192000,466121,351130,351190,351110,351120,91000,99000,711002,353001,81400,360010,360020,352020,352010) THEN 'MINERIA, ENERGIA, PETROLEO, AGUA Y GAS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (801090,9,181109,7,433040,952910,952990,952920,952300,742000,749002,749003,749001,16291,12,11,181200) THEN 'OFICIOS Y OTROS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (639100,581300,581900,602100,601000,181101,639900,602320,581100,602310,602200,602900,581200) THEN 'PRENSA Y MEDIOS DE COMUNICACIÓN'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (110100,239421,108000,242010,110420,110492,107301,239422,239410,110300,120091,107991,101030,107110,110491,239591,104020,107410,107420,102002,107999,107309,107129,120099,105090,105020,110290,107930,105030,107121,103012,107912,110411,81200,221909,281900,201300,201210,252000,239593,239399,259302,323001,162902,170910,170990,239310,162901,309200,321020,201220,281201,259992,251101,329030,170202,259309,281400,202907,201140,281301,202320,201120,231010,259910,222010,329040,329020,202906,203000,201110,162100,281500,322001,202312,321011,324000,239201,329010,282300,282500,282901,281600,281700,282909,201130,201409,201180,201190,210010,210020,239510,310020,310010,282200,239391,321012,170201,170102,170101,202200,202311,239209,239100,162903,210090,162909,231090,259999,259993,251102,239900,222090,242090,202908,162300,201401,239202,110412,310030,251200,259991,282110,162202,241009,231020,259100,243100,243200,329090,241001,109000,204000,952200,104013,104011,101040,104012,102001,103091,103099,103030,103011,105010,101020,101099,101012,101011,101040,101091,106131,106120,106110,106139,106200,107200,107930,107911,107920,107992,110211,110212,202101,282120,282130,161001,161002,103020,162201,282400,239592,259200,251300,239600,210030,107500,191000,259301,282600,120010,102003,101013) THEN 'PRODUCCION Y MANUFACTURA (SIN TEXTIL, ELECTRONICA Y AUTOMOTRIZ)'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (780000) THEN 'RECURSOS HUMANOS Y CAPACITACION'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (721020,712000,863300,862110,931050,870100,862130,864000,702010,861020,861010,862120,863110,863190,863120,869010,862200,869090,870990,750000,870210,870910,870220,863200,870920,880000,970000) THEN 'SALUD, MEDICINA, FARMACIA Y ASISTENCIA SOCIAL'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (641100,842400,10,841900,842100,842200,910300,843000,16111,842500,841100,842300,841300,841200) THEN 'SECTOR PUBLICO'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (653000,652000,662090,651210,662020,651120,651220,651130,651320,651110,651310) THEN 'SEGUROS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (390000,381100,381200,382010,382020,370000) THEN 'SERVICIOS DE MANEJO DE RESIDUOS Y DE REMEDIACION'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (949200,949100,990000) THEN 'SERVICIOS DE ORGANIZACIONES POLITICAS Y RELIGIOSAS'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (681020,681010,682099,681099,681098,682091,682010) THEN 'SERVICIOS INMOBILIARIOS Y ALQUILER DE BIENES MUEBLES E INTANGIBLES'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (960910,960201,960202,960990,960101,960300,960102) THEN 'SERVICIOS PERSONALES (SECTOR A INCORPORAR EN TAXONOMIA DE TYP) POSICION 96 DE LA LETRA S (FUENTE: CLAE AFIP)'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (279000,262000,264000,263000,721010,631200,952100,951200,951100,620200,620100,620300,620900,611010,614010,801020,619000,613000,614090,611090,612000,711003,631190,631120,631110,271020,271010,266010,266090,265101,265200,267002,265102,268000,261000,267001,266010,266090,272000,274000,275091,275020,273110,275099,275092,273190,275010 ) THEN 'TECNOLOGIA, SISTEMAS Y TELECOMUNICACIONES'
    WHEN TRY_CAST(cod_actividad_afip_o_naes AS INT) IN (131300,141130,141140,141120,141110,141191,139209,139204,131132,131131,131139,143010,143020,139900,131202,131209,131201,149000,142000,131120,131110,139400,139202,139203,139201,139100,139300,151100,141191,141199,141201,141202,152040,152011,152031,152021,151200) THEN 'TEXTIL'
END sector_productivo,
--se crea el campo sector estrategico
CASE
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('29') THEN 'AUTOMOTRIZ'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('45','46') THEN 'COMERCIO'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('41','42','43') THEN 'CONSTRUCCION'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('87','88') THEN 'CUIDADOS DE PERSONA'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('26') THEN 'ELECTRONICA'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('35') THEN 'ENERGIA'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('72','85') THEN 'ENSEÑANZA'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2) IN ('56') THEN 'GASTRONOMIA'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('55') THEN 'HOTELERIA'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('10','11','12','17','18','19','20','21','22','23','24','25','27','28','30','31','32','33') THEN 'INDUSTRIA MANUFACTURERA (SIN TEXTIL, ELECTRONICA Y AUTOMOTRIZ)'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('58','59','73','90') THEN 'INDUSTRIAS CREATIVAS'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('62','63') THEN 'INFORMATICA'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('52','53') THEN 'LOGISTICA'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('86') THEN 'SALUD (SIN CUIDADOS DE PERSONAS)'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('69','70','71','74','78','82') THEN 'SERVICIOS EMPRESARIALES'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('64','65','66') THEN 'SERVICIOS FINANCIEROS'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2) IN ('96') THEN 'SERVICIOS PERSONALES (SECTOR A INCORPORAR EN TAXONOMIA DE TYP) POSICION 96 DE LA LETRA S (FUENTE: CLAE AFIP)'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('13','14','15') THEN 'TEXTIL'
    WHEN SUBSTRING(cod_actividad_afip_o_naes_string,1,2)  IN ('79','91') THEN 'TURISMO (SIN HOTELERIA Y GASTRONOMIA)'
END sector_estrategico
FROM 
(SELECT 
TRY_CAST(cod_actividad_afip_o_naes AS INT) AS cod_actividad_afip_o_naes,
cod_actividad_afip_o_naes AS cod_actividad_afip_o_naes_string,
UPPER(desc_actividad_afip_o_naes) AS actividad_clae
FROM "caba-piba-raw-zone-db"."tbp_typ_tmp_nomenclador_actividades_economicas"
) cl
WHERE (cod_actividad_afip_o_naes IS NOT NULL OR LENGTH(TRIM(TRY_CAST(cod_actividad_afip_o_naes AS VARCHAR))) <> 0)
GROUP BY 1,2,3,4,5
),
--Match sector estrategico - sector productivo
asi AS (
SELECT
asi.id_sector_estrategico,
--se crea el campo sector productivo
CASE
    WHEN asi.id_sector_estrategico IN (15,13) THEN 'ADMINISTRACION, CONTABILIDAD Y FINANZAS'
    WHEN asi.id_sector_estrategico IN (4)  THEN 'AUTOMOTRIZ'
    WHEN asi.id_sector_estrategico IN (7)  THEN 'COMERCIAL, VENTAS Y NEGOCIOS'
    WHEN asi.id_sector_estrategico IN (16) THEN 'EDUCACION, DOCENCIA E INVESTIGACION'
    WHEN asi.id_sector_estrategico IN (12) THEN 'ENTRETENIMIENTO, ESPECTACULOS Y ACTIVIDADES CULTURALES'
    WHEN asi.id_sector_estrategico IN (9,10,11) THEN 'GASTRONOMIA, HOTELERIA Y TURISMO'
    WHEN asi.id_sector_estrategico IN (6) THEN 'INGENIERIA CIVIL, ARQUITECTURA Y CONSTRUCCION'
    WHEN asi.id_sector_estrategico IN (8) THEN 'ABASTECIMIENTO Y LOGISTICA'
    WHEN asi.id_sector_estrategico IN (5) THEN 'MINERIA, ENERGIA, PETROLEO, AGUA Y GAS'
    WHEN asi.id_sector_estrategico IN (1) THEN 'PRODUCCION Y MANUFACTURA (SIN TEXTIL, ELECTRONICA Y AUTOMOTRIZ)'
    WHEN asi.id_sector_estrategico IN (17,18) THEN 'SALUD, MEDICINA, FARMACIA Y ASISTENCIA SOCIAL'
    WHEN asi.id_sector_estrategico IN (19) THEN 'SERVICIOS PERSONALES (SECTOR A INCORPORAR EN TAXONOMIA DE TYP) POSICION 96 DE LA LETRA S (FUENTE: CLAE AFIP)'
    WHEN asi.id_sector_estrategico IN (3,14)  THEN 'TECNOLOGIA, SISTEMAS Y TELECOMUNICACIONES'
    WHEN asi.id_sector_estrategico IN (2) THEN 'TEXTIL'
END sector_productivo,
--se crea el campo sector estrategico
asi.sector_estrategico
FROM (
SELECT * FROM "caba-piba-staging-zone-db"."tbp_typ_def_sector_estrategico"
) asi
),
--Match sector estrategico - sector productivo - CLANAE
clanae AS (
SELECT
cln.codigo_4_digitos_clanae,
cln.sector_productivo AS sp_clanae,
--se crea el campo sector productivo
CASE
    WHEN cln.codigo_4_digitos_clanae IN ('52.42','52.41','52.30','52.10','52.20','52.43','50.22','50.12','50.11','50.21','49.32','49.21','49.31','49.12','49.22','49.11','30.92','30.99','30.91','30.30','30.11','30.12','30.20','53.00') THEN 'ABASTECIMIENTO Y LOGISTICA'
    WHEN cln.codigo_4_digitos_clanae IN ('64.11','64.92','64.20','64.99','64.30','64.19','64.91','66.19','66.30','66.20','66.11','70.10','70.20','69.10','69.20','82.91','82.92','82.20','82.99','82.11','82.19','82.30','94.92','94.20','94.99','94.11','94.91','94.12') THEN 'ADMINISTRACION, CONTABILIDAD Y FINANZAS'
    WHEN cln.codigo_4_digitos_clanae IN ('51.10','51.20') THEN 'AERONAUTICA'
    WHEN cln.codigo_4_digitos_clanae IN ('01.27','01.48','01.47','01.14','01.26','01.13','01.29','01.12','01.23','01.62','01.45','01.21','01.61','01.42','01.28','01.41','01.11','01.22','01.70','01.30','01.15','01.44','01.43','01.46','01.24','01.49','01.19','01.25','03.20','03.12','03.11','03.13','02.10','02.20','02.40') THEN 'AGRICULTURA, GANADERIA, CAZA Y SERVICIOS CONEXOS'
    WHEN cln.codigo_4_digitos_clanae IN ('29.10','29.20','29.30') THEN 'AUTOMOTRIZ'
    WHEN cln.codigo_4_digitos_clanae IN ('45.26','45.29','45.25','45.32','45.27','45.21','45.24','45.12','45.28','45.31','45.22','45.23','45.11','45.40','46.53','46.31','46.54','46.42','46.49','46.55','46.59','46.90','46.22','46.52','46.69','46.33','46.56','46.44','46.45','46.32','46.43','46.21','46.63','46.46','46.51','46.61','46.62','46.41','47.21','47.51','47.62','47.78','47.52','47.72','47.22','47.23','47.73','47.74','47.91','47.63','47.19','47.11','47.54','47.64','47.30','47.40','47.61','47.71','47.53','47.80','47.99','77.11','77.20','77.30','77.12','77.40') THEN 'COMERCIAL, VENTAS Y NEGOCIOS'
    WHEN cln.codigo_4_digitos_clanae IN ('85.21','85.33','85.50','85.32','85.49','85.22','85.31','85.10','74.20','74.10','74.90') THEN 'EDUCACION, DOCENCIA E INVESTIGACION'
    WHEN cln.codigo_4_digitos_clanae IN ('59.11','59.13','59.12','59.20','91.03','91.02','91.01','91.09','92.00','90.00','93.10','93.90','18.20') THEN 'ENTRETENIMIENTO, ESPECTACULOS Y ACTIVIDADES CULTURALES'
    WHEN cln.codigo_4_digitos_clanae IN ('79.11','79.12','79.19','55.20','55.10','56.10','56.20') THEN 'GASTRONOMIA, HOTELERIA Y TURISMO'
    WHEN cln.codigo_4_digitos_clanae IN ('42.22','42.21','42.10','42.90','43.30','43.91','43.29','43.11','43.99','43.12','43.22','43.21','71.20','71.10','41.00') THEN 'INGENIERIA CIVIL, ARQUITECTURA Y CONSTRUCCION'
    WHEN cln.codigo_4_digitos_clanae IN ('33.12','33.20','33.14','33.19','33.13','33.11','81.30','81.10','81.20') THEN 'LIMPIEZA Y MANTENIMIENTO'
    WHEN cln.codigo_4_digitos_clanae IN ('73.10','73.20') THEN 'MARKETING Y PUBLICIDAD'
    WHEN cln.codigo_4_digitos_clanae IN ('08.13','08.92','08.14','08.11','08.93','08.99','08.91','08.12','06.20','06.10','07.21','07.29','07.10','35.13','35.12','35.30','35.20','35.11','05.20','05.10','09.10','09.90','36.00') THEN 'MINERIA, ENERGIA, PETROLEO, AGUA Y GAS'
    WHEN cln.codigo_4_digitos_clanae IN ('80.10','18.11','18.12') THEN 'OFICIOS Y OTROS'
    WHEN cln.codigo_4_digitos_clanae IN ('58.13','58.12','58.11','58.19','63.12','63.91','63.11','63.99','60.29','60.10','60.22','60.23','60.21') THEN 'PRENSA Y MEDIOS DE COMUNICACIÓN'
    WHEN cln.codigo_4_digitos_clanae IN ('10.71','10.50','10.90','10.75','10.10','10.30','10.74','10.72','10.62','10.40','10.80','10.79','10.73','10.61','10.20','28.15','28.29','28.17','28.19','28.14','28.26','28.11','28.21','28.22','28.16','28.13','28.12','28.23','28.24','28.25','20.29','20.21','20.11','20.23','20.12','20.22','20.40','20.30','20.14','20.13','32.20','32.90','32.10','32.30','32.40','22.20','22.11','22.19','16.23','16.21','16.10','16.22','16.29','11.04','11.01','11.02','11.03','25.11','25.99','25.92','25.20','25.93','25.91','25.13','25.12','17.01','17.09','17.02','24.10','24.31','24.32','24.20','31.00','23.94','23.99','23.91','23.92','23.95','23.10','23.93','23.96','21.00','19.20','19.10','12.00') THEN 'PRODUCCION Y MANUFACTURA (SIN TEXTIL, ELECTRONICA Y AUTOMOTRIZ)'
    WHEN cln.codigo_4_digitos_clanae IN ('78.00') THEN 'RECURSOS HUMANOS Y CAPACITACION'
    WHEN cln.codigo_4_digitos_clanae IN ('75.00','86.22','86.40','86.21','86.32','86.31','86.33','86.90','86.10','88.01','88.09','97.00','87.02','87.09','87.01') THEN 'SALUD, MEDICINA, FARMACIA Y ASISTENCIA SOCIAL'
    WHEN cln.codigo_4_digitos_clanae IN ('84.22','84.19','84.25','84.12','84.21','84.11','84.23','84.30','84.13','84.24') THEN 'SECTOR PUBLICO'
    WHEN cln.codigo_4_digitos_clanae IN ('65.11','65.13','65.30','65.12','65.20') THEN 'SEGUROS'
    WHEN cln.codigo_4_digitos_clanae IN ('38.11','38.12','38.20','37.00','39.00') THEN 'SERVICIOS DE MANEJO DE RESIDUOS Y DE REMEDIACION'
    WHEN cln.codigo_4_digitos_clanae IN ('99.00') THEN 'SERVICIOS DE ORGANIZACIONES POLITICAS Y RELIGIOSAS'
    WHEN cln.codigo_4_digitos_clanae IN ('68.10','68.20') THEN 'SERVICIOS INMOBILIARIOS Y ALQUILER DE BIENES MUEBLES E INTANGIBLES'
    WHEN cln.codigo_4_digitos_clanae IN ('96.01','96.02','96.03','96.09') THEN 'SERVICIOS PERSONALES (SECTOR A INCORPORAR EN TAXONOMIA DE TYP) POSICION 96 DE LA LETRA S (FUENTE: CLAE AFIP)'
    WHEN cln.codigo_4_digitos_clanae IN ('61.10','61.90','61.20','61.40','61.30','72.20','72.10','95.11','95.29','95.12','95.23','95.22','95.21','27.90','27.50','27.40','27.31','27.10','27.20','62.03','62.02','62.09','62.01','26.80','26.51','26.30','26.70','26.60','26.20','26.40','26.10','26.52') THEN 'TECNOLOGIA, SISTEMAS Y TELECOMUNICACIONES'
    WHEN cln.codigo_4_digitos_clanae IN ('13.11','13.94','13.91','13.92','13.13','13.99','13.12','13.93','14.90','14.11','14.30','14.12','14.20','15.11','15.20','15.12') THEN 'TEXTIL'
END sector_productivo,
--se crea el campo sector estrategico
CASE
    WHEN cln.codigo_4_digitos_clanae IN ('29.10','29.20','29.30') THEN 'AUTOMOTRIZ'
    WHEN cln.codigo_4_digitos_clanae IN ('45.11','45.12','45.21','45.22','45.23','45.24','45.25','45.26','45.27','45.28','45.29','45.31','45.32','45.40','46.21','46.22','46.31','46.32','46.33','46.41','46.42','46.43','46.44','46.45','46.46','46.49','46.51','46.52','46.53','46.54','46.55','46.56','46.59','46.61','46.62','46.63','46.69','46.90') THEN 'COMERCIO'
    WHEN cln.codigo_4_digitos_clanae IN ('41.00','42.10','42.21','42.22','42.90','43.11','43.12','43.21','43.22','43.29','43.30','43.91','43.99') THEN 'CONSTRUCCION'
    WHEN cln.codigo_4_digitos_clanae IN ('87.01','87.02','87.09','88.01','88.09') THEN 'CUIDADOS DE PERSONA'
    WHEN cln.codigo_4_digitos_clanae IN ('72.10','72.20','85.31','85.32','85.33','85.49','85.50') THEN 'ENSEÑANZA'
    WHEN cln.codigo_4_digitos_clanae IN ('26.10','26.20','26.30','26.40','26.51','26.52','26.60','26.70','26.80') THEN 'ELECTRONICA'
    WHEN cln.codigo_4_digitos_clanae IN ('35.13','35.12','35.30','35.20','35.11') THEN 'ENERGIA'
    WHEN cln.codigo_4_digitos_clanae IN ('56.10','56.20')  THEN 'GASTRONOMIA'
    WHEN cln.codigo_4_digitos_clanae IN ('55.10','55.20') THEN 'HOTELERIA'
    WHEN cln.codigo_4_digitos_clanae IN ('62.01','62.02','62.03','62.09','63.11','63.12','63.91','63.99') THEN 'INFORMATICA'
    WHEN cln.codigo_4_digitos_clanae IN ('58.11','58.12','58.13','58.19','59.11','59.12','59.13','59.20','73.10','73.20','90.00') THEN 'INDUSTRIAS CREATIVAS'
    WHEN cln.codigo_4_digitos_clanae IN ('10.10','10.20','10.30','10.40','10.50','10.61','10.62','10.71','10.72','10.73','10.74','10.75','10.79','10.80','10.90','11.01','11.02','11.03','11.04','17.01','17.02','17.09','18.11','18.12','18.20','19.10','19.20','20.11','20.12','20.13','20.14','20.21','20.22','20.23','20.29','20.30','20.40','21.00','22.11','22.19','22.20','23.10','23.91','23.92','23.93','23.94','23.95','23.96','23.99','24.10','24.20','24.31','24.32','25.11','25.12','25.13','25.20','25.91','25.92','25.93','25.99','27.10','27.20','27.31','27.40','27.50','27.90','28.11','28.12','28.13','28.14','28.15','28.16','28.17','28.19','28.21','28.22','28.23','28.24','28.25','28.26','28.29','30.11','30.12','30.20','30.30','30.91','30.92','30.99','31.00','32.10','32.20','32.30','32.40','32.90','33.11','33.12','33.13','33.14','33.19','33.20','12.00') THEN 'INDUSTRIA MANUFACTURERA (SIN TEXTIL, ELECTRONICA Y AUTOMOTRIZ)'
    WHEN cln.codigo_4_digitos_clanae IN ('52.10','52.20','52.30','52.41','52.42','52.43','53.00') THEN 'LOGISTICA'
    WHEN cln.codigo_4_digitos_clanae IN ('69.10','69.20','70.10','70.20','71.10','71.20','74.10','74.20','74.90','78.00','82.11','82.19','82.20','82.30','82.91','82.92','82.99') THEN 'SERVICIOS EMPRESARIALES'
    WHEN cln.codigo_4_digitos_clanae IN ('64.11','64.19','64.20','64.30','64.91','64.92','64.99','65.11','65.12','65.13','65.20','65.30','66.11','66.19','66.20','66.30') THEN 'SERVICIOS FINANCIEROS'
    WHEN cln.codigo_4_digitos_clanae IN ('86.10','86.21','86.22','86.31','86.32','86.33','86.40','86.90') THEN 'SALUD (SIN CUIDADOS DE PERSONAS)'
	WHEN cln.codigo_4_digitos_clanae IN ('96.01','96.02','96.03','96.09') THEN 'SERVICIOS PERSONALES (SECTOR A INCORPORAR EN TAXONOMIA DE TYP) POSICION 96 DE LA LETRA S (FUENTE: CLAE AFIP)'
    WHEN cln.codigo_4_digitos_clanae IN ('13.11','13.12','13.13','13.91','13.92','13.93','13.94','13.99','14.11','14.12','14.20','14.30','14.90','15.11','15.12','15.20') THEN 'TEXTIL'
    WHEN cln.codigo_4_digitos_clanae IN ('79.11','79.12','79.19','91.01','91.02','91.03','91.09') THEN 'TURISMO (SIN HOTELERIA Y GASTRONOMIA)'
END sector_estrategico
FROM (SELECT 
	codigo_4_digitos AS codigo_4_digitos_clanae,
	sp.sector_productivo
FROM "caba-piba-raw-zone-db"."mec_codigos_clanae_ctividades_economicas" clae
	JOIN (
		SELECT "letra",
			"codigo_2_digitos",
			"descripcion" AS sector_productivo
		FROM "caba-piba-raw-zone-db"."mec_codigos_clanae_ctividades_economicas"
		where "codigo_3_digitos" IS NULL
			AND "codigo_4_digitos" IS NULL
			AND "codigo_5_digitos" IS NULL
		GROUP BY "letra",
			"codigo_2_digitos",
			"descripcion"
	) sp ON (
		clae.letra = sp.letra
		AND clae.codigo_2_digitos = sp.codigo_2_digitos
	)
WHERE codigo_4_digitos IS NOT NULL
GROUP BY 1,2) cln
),
--Se unifican los sectores productivos y estrategicos (en caso de corresponder) provenientes de CLAE, CLANAE y la tabla de sectores estrategicos definidos por GCBA
--acá se rompe!
uf AS (
SELECT
clae.codigo_clae_string AS codigo_clae,
asi.id_sector_estrategico,
'' AS codigo_4_digitos_clanae,
CASE
    WHEN clae.sector_productivo IS NULL AND asi.sector_productivo IS NOT NULL THEN asi.sector_productivo
    ELSE clae.sector_productivo
END sector_productivo,
CASE
    WHEN clae.sector_estrategico IS NULL AND asi.sector_estrategico IS NOT NULL THEN asi.sector_estrategico
    ELSE clae.sector_estrategico
END sector_estrategico
FROM clae
FULL OUTER JOIN asi ON (clae.sector_productivo = asi.sector_productivo AND clae.sector_estrategico = asi.sector_estrategico)
UNION
SELECT
NULL AS codigo_clae,
asi.id_sector_estrategico,
clanae.codigo_4_digitos_clanae,
CASE
    WHEN clanae.sector_productivo IS NULL THEN asi.sector_productivo
    ELSE clanae.sector_productivo
END sector_productivo,
CASE
    --WHEN asi.sector_estrategico IS NULL THEN clanae.sector_estrategico
    WHEN clanae.sector_estrategico IS NULL THEN asi.sector_estrategico 
    ELSE clanae.sector_estrategico 
END sector_estrategico
FROM clanae
FULL OUTER JOIN asi ON (clanae.sector_productivo = asi.sector_productivo AND clanae.sector_estrategico = asi.sector_estrategico)
),
--Se agrega el campo "codigo_sector_productivo"
sp AS (
SELECT
uf.codigo_clae,
uf.id_sector_estrategico,
CASE WHEN LENGTH(TRIM(uf.codigo_4_digitos_clanae))=0 THEN NULL ELSE uf.codigo_4_digitos_clanae END codigo_4_digitos_clanae,
sp.id_sector_productivo AS codigo_sector_productivo,
uf.sector_productivo,
uf.sector_estrategico
FROM uf
LEFT JOIN "caba-piba-staging-zone-db"."tbp_typ_def_sector_productivo" sp ON (uf.sector_productivo = sp.sector_productivo)
WHERE uf.codigo_clae IS NOT NULL
OR (uf.codigo_4_digitos_clanae IS NOT NULL AND LENGTH(TRIM(uf.codigo_4_digitos_clanae))>0)
GROUP BY 
uf.codigo_clae,
uf.id_sector_estrategico,
CASE WHEN LENGTH(TRIM(uf.codigo_4_digitos_clanae))=0 THEN NULL ELSE uf.codigo_4_digitos_clanae END,
sp.id_sector_productivo,
uf.sector_productivo,
uf.sector_estrategico
),
spf AS (
SELECT
sp.codigo_clae,
codigo_4_digitos_clanae,
CASE
    WHEN sp.id_sector_estrategico IS NULL THEN se.id_sector_estrategico
    ELSE sp.id_sector_estrategico
END id_sector_estrategico,
sp.codigo_sector_productivo AS id_sector_productivo,
sp.sector_productivo,
sp.sector_estrategico
FROM sp
LEFT JOIN "caba-piba-staging-zone-db".tbp_typ_def_sector_estrategico se ON (sp.sector_estrategico = se.sector_estrategico)
)
SELECT *
FROM spf
--</sql>--